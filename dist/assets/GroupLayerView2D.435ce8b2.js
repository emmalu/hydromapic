var V=Object.defineProperty,f=Object.defineProperties;var g=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var p=(e,i,r)=>i in e?V(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,b=(e,i)=>{for(var r in i||(i={}))m.call(i,r)&&p(e,r,i[r]);if(y)for(var r of y(i))_.call(i,r)&&p(e,r,i[r]);return e},u=(e,i)=>f(e,g(i));import{Z as n,_ as h,d0 as L,a0 as v,cc as O,ct as F}from"./index.ab15bc04.js";import{b as C}from"./WGLContainer.7a493591.js";import{L as E}from"./enums.457e23f9.js";import{u as R,f as x}from"./LayerView.00833560.js";import"./pixelUtils.749c08fa.js";import"./Container.eaeadb22.js";import"./VertexArrayObject.cc747ff8.js";import"./Texture.b30343f5.js";import"./VertexElementDescriptor.0406f2d4.js";import"./enums.84480fc7.js";import"./Utils.74f9282d.js";import"./ProgramTemplate.0c38b6c3.js";import"./StyleDefinition.809d5a5e.js";import"./config.bd364997.js";import"./GeometryUtils.5ea26345.js";import"./MaterialKey.9467dbe0.js";import"./earcut.91e104de.js";class H extends C{constructor(){super(...arguments),this.requiresDedicatedFBO=!1}dispose(){}doRender(i){const r=this.createRenderParams(i),{context:t,painter:s,profiler:o}=r;this._prevFBO=t.getBoundFramebufferObject(),o.recordContainerStart(this.name);const d=this._getFbo(r),w=s.getRenderTarget();t.bindFramebuffer(d),s.setRenderTarget(d),t.setDepthWriteEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),t.setDepthWriteEnabled(!1);for(const l of this.children)l.beforeRender(i);for(const l of this.children)l.processRender(r);for(const l of this.children)l.afterRender(i);s.setRenderTarget(w),s.releaseFbo(d),t.bindFramebuffer(this._prevFBO),s.beforeRenderLayer(r,this._clippingInfos?255:0,this.computedOpacity),t.setStencilTestEnabled(!1),t.setStencilWriteMask(0),s.blitTexture(t,d.colorTexture,E.NEAREST),s.compositeLayer(r,this.computedOpacity),o.recordContainerEnd()}createRenderParams(i){return u(b({},super.createRenderParams(i)),{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1})}_getFbo(i){const{context:r,painter:t}=i,{width:s,height:o}=r.getViewport();return t.acquireFbo(s,o)}}let a=class extends R{constructor(e){super(e),this.type="group",this.layerViews=new O}initialize(){this.handles.add([this.layerViews.on("change",e=>this._layerViewsChangeHandler(e)),this.layer.watch("visibilityMode",()=>this._visibilityModeHandler(),!0),this.watch("visible",()=>this._visibleHandler(),!0)],"grouplayerview"),this._layerViewsChangeHandler({target:null,added:this.layerViews.toArray(),removed:[],moved:[]})}set layerViews(e){this._set("layerViews",F(e,this._get("layerViews")))}get updatingProgress(){return this.layerViews.length===0?1:this.layerViews.reduce((e,i)=>e+i.updatingProgress,0)/this.layerViews.length}isUpdating(){return this.layerViews.some(e=>e.updating)}_hasLayerViewVisibleOverrides(){return this.layerViews.some(e=>e._isOverridden("visible"))}_findLayerViewForLayer(e){return e&&this.layerViews.find(i=>i.layer===e)}_firstVisibleOnLayerOrder(){const e=this.layer.layers.find(i=>{const r=this._findLayerViewForLayer(i);return r&&r.visible});return e&&this._findLayerViewForLayer(e)}_enforceExclusiveVisibility(e){this._hasLayerViewVisibleOverrides()&&(e||!(e=this._firstVisibleOnLayerOrder())&&this.layerViews.length>0&&(e=this._findLayerViewForLayer(this.layer.layers.getItemAt(0))),this.layerViews.forEach(i=>{i.visible=i===e}))}_layerViewsChangeHandler(e){this.handles.remove("grouplayerview:visible"),this.handles.add(this.layerViews.map(t=>t.watch("visible",s=>this._layerViewVisibleHandler(s,t),!0)).toArray(),"grouplayerview:visible");const i=e.added[e.added.length-1];let r=null;i&&i.visible&&(r=i),this._enforceVisibility(r)}_enforceVisibility(e){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case"inherited":{const i=this.visible;this.layerViews.forEach(r=>{r.visible=i});break}case"exclusive":this._enforceExclusiveVisibility(e)}}_visibilityModeHandler(){this._enforceVisibility()}_layerViewVisibleHandler(e,i){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case"inherited":e!==this.visible&&(i.visible=this.visible);break;case"exclusive":this._enforceExclusiveVisibility(e&&i)}}_visibleHandler(){var e;this._hasLayerViewVisibleOverrides()&&((e=this.layer)==null?void 0:e.visibilityMode)==="inherited"&&this._enforceVisibility()}};n([h({cast:L})],a.prototype,"layerViews",null),n([h({readOnly:!0})],a.prototype,"updatingProgress",null),n([h()],a.prototype,"view",void 0),a=n([v("esri.views.layers.GroupLayerView")],a);const M=a;let c=class extends x(M){constructor(){super(...arguments),this.container=new H}attach(){this._updateStageChildren(),this.handles.add(this.layerViews.on("after-changes",()=>this._updateStageChildren()),"grouplayerview2d")}detach(){this.handles.remove("grouplayerview2d"),this.container.removeAllChildren()}update(e){}moveStart(){}viewChange(){}moveEnd(){}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach((e,i)=>this.container.addChildAt(e.container,i))}};c=n([v("esri.views.2d.layers.GroupLayerView2D")],c);const K=c;export{K as default};
